(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();class ee{constructor(){this.sideButtonEnabled=!0,this.scrollWheelEnabled=!0,this.eventListeners=new Map}init(e={}){this.sideButtonEnabled=e.sideButtonEnabled??!0,this.scrollWheelEnabled=e.scrollWheelEnabled??!0,this.sideButtonEnabled&&this.setupSideButtonListener(),this.scrollWheelEnabled&&this.setupScrollWheelListener(),e.keyboardFallback!==!1&&this.setupKeyboardFallback()}setupSideButtonListener(){window.addEventListener("sideClick",e=>{this.sideButtonEnabled&&this.handleSideButtonClick(e)})}setupScrollWheelListener(){window.addEventListener("scrollUp",e=>{this.scrollWheelEnabled&&this.handleScrollWheel({direction:"up",event:e})}),window.addEventListener("scrollDown",e=>{this.scrollWheelEnabled&&this.handleScrollWheel({direction:"down",event:e})})}setupKeyboardFallback(){window.addEventListener("keydown",e=>{if(e.code==="Space"){e.preventDefault();const n=new CustomEvent("sideClick",{detail:{source:"keyboard"}});window.dispatchEvent(n)}})}handleSideButtonClick(e){(this.eventListeners.get("sideButton")||[]).forEach(o=>o(e))}handleScrollWheel(e){(this.eventListeners.get("scrollWheel")||[]).forEach(o=>o({direction:e.direction,event:e.event}))}on(e,n){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(n)}off(e,n){const o=this.eventListeners.get(e)||[],s=o.indexOf(n);s>-1&&o.splice(s,1)}}const P=new ee;class te{constructor(){this.screenWidth=240}setupViewport(){let e=document.querySelector('meta[name="viewport"]');e||(e=document.createElement("meta"),e.name="viewport",document.head.appendChild(e)),e.content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"}}const re=new te;function O(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function U(t,e){const n=new Float32Array(16);for(let o=0;o<4;o++){const s=t[o],i=t[o+4],a=t[o+8],l=t[o+12];n[o]=s*e[0]+i*e[1]+a*e[2]+l*e[3],n[o+4]=s*e[4]+i*e[5]+a*e[6]+l*e[7],n[o+8]=s*e[8]+i*e[9]+a*e[10]+l*e[11],n[o+12]=s*e[12]+i*e[13]+a*e[14]+l*e[15]}return n}function oe(t,e,n,o){const s=1/Math.tan(t/2),i=1/(n-o),a=new Float32Array(16);return a[0]=s/e,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=s,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(o+n)*i,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*o*n*i,a[15]=0,a}function ne(t,e){const[n,o,s]=e,i=t.slice(0);return i[12]=t[0]*n+t[4]*o+t[8]*s+t[12],i[13]=t[1]*n+t[5]*o+t[9]*s+t[13],i[14]=t[2]*n+t[6]*o+t[10]*s+t[14],i[15]=t[3]*n+t[7]*o+t[11]*s+t[15],i}function se(t,e){const n=Math.sin(e),o=Math.cos(e),s=new Float32Array([1,0,0,0,0,o,n,0,0,-n,o,0,0,0,0,1]);return U(t,s)}function ie(t,e){const n=Math.sin(e),o=Math.cos(e),s=new Float32Array([o,0,-n,0,0,1,0,0,n,0,o,0,0,0,0,1]);return U(t,s)}re.setupViewport();P.init();const c=document.getElementById("glcanvas"),r=c.getContext("webgl2",{antialias:!0});r||console.error("WebGL2 not supported");function Y(t,e,n){const o=t.createShader(e);return t.shaderSource(o,n),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)?o:(console.error(t.getShaderInfoLog(o)||"Shader compile error"),t.deleteShader(o),null)}function ae(t,e,n){const o=Y(t,t.VERTEX_SHADER,e),s=Y(t,t.FRAGMENT_SHADER,n),i=t.createProgram();return t.attachShader(i,o),t.attachShader(i,s),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)?i:(console.error(t.getProgramInfoLog(i)||"Program link error"),t.deleteProgram(i),null)}const le=`#version 300 es
precision highp float;
layout(location=0) in vec3 a_position;
layout(location=1) in vec3 a_color;
layout(location=2) in vec3 a_offset; // per-instance world-space offset
uniform mat4 u_vp;     // view-projection
uniform mat4 u_model;  // model rotation only
out vec3 v_color;
void main(){
  v_color = a_color;
  vec3 rotated = (u_model * vec4(a_position, 1.0)).xyz;
  vec3 worldPos = rotated + a_offset;
  gl_Position = u_vp * vec4(worldPos, 1.0);
}`,ce=`#version 300 es
precision highp float;
in vec3 v_color;
out vec4 outColor;
void main(){
  outColor = vec4(v_color, 1.0);
}`,T=ae(r,le,ce);r.useProgram(T);const E=new Float32Array([1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1,-1,1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1]),fe=new Float32Array([1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,1,1,0,1,1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0,1,1,0,1,1]),q=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),K=r.createVertexArray();r.bindVertexArray(K);const j=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,j);r.bufferData(r.ARRAY_BUFFER,E,r.DYNAMIC_DRAW);r.enableVertexAttribArray(0);r.vertexAttribPointer(0,3,r.FLOAT,!1,0,0);const ue=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,ue);r.bufferData(r.ARRAY_BUFFER,fe,r.STATIC_DRAW);r.enableVertexAttribArray(1);r.vertexAttribPointer(1,3,r.FLOAT,!1,0,0);const de=r.createBuffer();r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,de);r.bufferData(r.ELEMENT_ARRAY_BUFFER,q,r.STATIC_DRAW);const k=r.getUniformLocation(T,"u_vp"),N=r.getUniformLocation(T,"u_model");r.enable(r.DEPTH_TEST);r.clearColor(.03,.03,.05,1);function he(){const t=Math.min(window.devicePixelRatio||1,2),e=Math.floor(c.clientWidth*t),n=Math.floor(c.clientHeight*t);(c.width!==e||c.height!==n)&&(c.width=e,c.height=n),r.viewport(0,0,c.width,c.height)}const f=document.createElement("div");f.style.position="fixed";f.style.left="8px";f.style.top="8px";f.style.padding="4px 6px";f.style.background="rgba(0,0,0,0.5)";f.style.color="#0f0";f.style.fontFamily="monospace";f.style.fontSize="12px";f.style.zIndex="1000";f.style.pointerEvents="none";document.body.appendChild(f);const pe=1e3;let A=[],F=0,V=performance.now(),v=256,d=0;const I=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,I);r.bufferData(r.ARRAY_BUFFER,v*3*4,r.DYNAMIC_DRAW);r.enableVertexAttribArray(2);r.vertexAttribPointer(2,3,r.FLOAT,!1,0,0);r.vertexAttribDivisor(2,1);let y=new Float32Array(v*3);function ye(t){if(t<=v)return;let e=v;for(;e<t;)e*=2;const n=new Float32Array(e*3);n.set(y.subarray(0,d*3)),y=n,v=e,r.bindBuffer(r.ARRAY_BUFFER,I),r.bufferData(r.ARRAY_BUFFER,v*3*4,r.DYNAMIC_DRAW),d>0&&r.bufferSubData(r.ARRAY_BUFFER,0,y.subarray(0,d*3))}function $(t){ye(d+1);const e=d*3;y[e]=t[0],y[e+1]=t[1],y[e+2]=t[2],r.bindBuffer(r.ARRAY_BUFFER,I),r.bufferSubData(r.ARRAY_BUFFER,e*4,y.subarray(e,e+3)),d++}function me(){d<=0||d--}let B=4;const _=50;let Ae=0;function z(t,e){let n=1,o=0,s=t;for(;s>0;)n/=e,o+=n*(s%e),s=Math.floor(s/e);return o}function X(){const t=++Ae,e=z(t,2),n=z(t,3),o=-e,s=2*Math.PI*n,i=Math.sqrt(Math.max(0,1-o*o)),a=i*Math.cos(s),l=i*Math.sin(s),h=o,u=a*_,R=l*_,g=B+h*_;return[u,R,g]}let G=0,H=0,M=1;const ve=2e3;let x=0,p=0;P.on("scrollWheel",({direction:t,event:e})=>{const n=performance.now(),o=t==="up"?1:-1;o===H&&n-G<ve?M+=1:M=1,G=n,H=o,x+=o*M});for(let t=0;t<10;t++)$(X());function J(t){he();const e=t*.001,n=t-V;for(V=t,A.push(n),F+=n;F>pe&&A.length>0;)F-=A.shift();if(A.length>0){const l=A.length,h=F/l,u=1e3/Math.max(1e-4,h),R=A.map(S=>1e3/Math.max(1e-4,S)).sort((S,Z)=>S-Z),g=Math.max(0,Math.floor(.01*l)),Q=R[g];f.textContent=`fps ${u.toFixed(1)} | 1% ${Q.toFixed(1)} | N ${l}`}const o=Math.max(0,Math.min(.1,n*.001)),s=Math.exp(-.4*o);x*=s,p+=x*o;let i=0;if(p>=1?(i=Math.floor(p),p-=i):p<=-1&&(i=Math.ceil(p),p-=i),i>0)for(let l=0;l<i;l++)$(X());else if(i<0)for(let l=0;l<-i;l++)me();r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);const a=c.width/Math.max(1,c.height);if(m&&!L&&(L=!0,w.postMessage({type:"compute",timeSec:e*b,aspect:a,cameraDistance:B})),D&&C)r.uniformMatrix4fv(k,!1,D),r.uniformMatrix4fv(N,!1,C);else{const l=oe(Math.PI/3,a,.1,100);let h=O();h=ne(h,[0,0,-B]);let u=O();u=ie(u,e*b),u=se(u,e*.7*b);const R=U(l,h);r.uniformMatrix4fv(k,!1,R),r.uniformMatrix4fv(N,!1,u)}m&&Ee(e*b),r.bindVertexArray(K),r.drawElementsInstanced(r.TRIANGLES,q.length,r.UNSIGNED_SHORT,0,Math.max(1,d)),requestAnimationFrame(J)}function we(){c.style.width||(c.style.width="100vw"),c.style.height||(c.style.height="100vh"),c.style.display="block"}we();requestAnimationFrame(J);let b=1;P.on("sideButton",()=>{b*=-1});let w,m=!1,L=!1,D=null,C=null,W=!1;function Re(){try{const t=E.buffer.slice(0);w.postMessage({type:"initGeometry",buffer:t,length:E.length},[t])}catch{}}function be(){try{w=new Worker(new URL(""+new URL("worker-BAEKGTU-.js",import.meta.url).href,import.meta.url),{type:"module"}),w.onmessage=t=>{const e=t.data;if(e){if(e.type==="result"){const{vp:n,model:o}=e;n&&n.buffer&&(D=new Float32Array(n.buffer,n.byteOffset||0,(n.byteLength||16*4)/4)),o&&o.buffer&&(C=new Float32Array(o.buffer,o.byteOffset||0,(o.byteLength||16*4)/4)),L=!1,m=!0}else if(e.type==="initAck")m=!0;else if(e.type==="transformResult"){const{buffer:n,byteOffset:o=0,byteLength:s}=e.positions||{};if(n&&s===E.byteLength){const i=new Float32Array(n,o,E.length);r.bindBuffer(r.ARRAY_BUFFER,j),r.bufferSubData(r.ARRAY_BUFFER,0,i)}W=!1}}},w.onerror=()=>{m=!1}}catch{m=!1}}be();Re();function Ee(t){!m||W||(W=!0,w.postMessage({type:"transform",timeSec:t}))}
