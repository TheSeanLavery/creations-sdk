(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();class ${constructor(){this.sideButtonEnabled=!0,this.scrollWheelEnabled=!0,this.eventListeners=new Map}init(e={}){this.sideButtonEnabled=e.sideButtonEnabled??!0,this.scrollWheelEnabled=e.scrollWheelEnabled??!0,this.sideButtonEnabled&&this.setupSideButtonListener(),this.scrollWheelEnabled&&this.setupScrollWheelListener(),e.keyboardFallback!==!1&&this.setupKeyboardFallback()}setupSideButtonListener(){window.addEventListener("sideClick",e=>{this.sideButtonEnabled&&this.handleSideButtonClick(e)})}setupScrollWheelListener(){window.addEventListener("scrollUp",e=>{this.scrollWheelEnabled&&this.handleScrollWheel({direction:"up",event:e})}),window.addEventListener("scrollDown",e=>{this.scrollWheelEnabled&&this.handleScrollWheel({direction:"down",event:e})})}setupKeyboardFallback(){window.addEventListener("keydown",e=>{if(e.code==="Space"){e.preventDefault();const n=new CustomEvent("sideClick",{detail:{source:"keyboard"}});window.dispatchEvent(n)}})}handleSideButtonClick(e){(this.eventListeners.get("sideButton")||[]).forEach(o=>o(e))}handleScrollWheel(e){(this.eventListeners.get("scrollWheel")||[]).forEach(o=>o({direction:e.direction,event:e.event}))}on(e,n){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(n)}off(e,n){const o=this.eventListeners.get(e)||[],s=o.indexOf(n);s>-1&&o.splice(s,1)}}const C=new $;class J{constructor(){this.screenWidth=240}setupViewport(){let e=document.querySelector('meta[name="viewport"]');e||(e=document.createElement("meta"),e.name="viewport",document.head.appendChild(e)),e.content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"}}const Q=new J;function T(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function U(t,e){const n=new Float32Array(16);for(let o=0;o<4;o++){const s=t[o],i=t[o+4],a=t[o+8],f=t[o+12];n[o]=s*e[0]+i*e[1]+a*e[2]+f*e[3],n[o+4]=s*e[4]+i*e[5]+a*e[6]+f*e[7],n[o+8]=s*e[8]+i*e[9]+a*e[10]+f*e[11],n[o+12]=s*e[12]+i*e[13]+a*e[14]+f*e[15]}return n}function Z(t,e,n,o){const s=1/Math.tan(t/2),i=1/(n-o),a=new Float32Array(16);return a[0]=s/e,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=s,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(o+n)*i,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*o*n*i,a[15]=0,a}function ee(t,e){const[n,o,s]=e,i=t.slice(0);return i[12]=t[0]*n+t[4]*o+t[8]*s+t[12],i[13]=t[1]*n+t[5]*o+t[9]*s+t[13],i[14]=t[2]*n+t[6]*o+t[10]*s+t[14],i[15]=t[3]*n+t[7]*o+t[11]*s+t[15],i}function te(t,e){const n=Math.sin(e),o=Math.cos(e),s=new Float32Array([1,0,0,0,0,o,n,0,0,-n,o,0,0,0,0,1]);return U(t,s)}function re(t,e){const n=Math.sin(e),o=Math.cos(e),s=new Float32Array([o,0,-n,0,0,1,0,0,n,0,o,0,0,0,0,1]);return U(t,s)}Q.setupViewport();C.init();const l=document.getElementById("glcanvas"),r=l.getContext("webgl2",{antialias:!0});r||console.error("WebGL2 not supported");function I(t,e,n){const o=t.createShader(e);return t.shaderSource(o,n),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)?o:(console.error(t.getShaderInfoLog(o)||"Shader compile error"),t.deleteShader(o),null)}function oe(t,e,n){const o=I(t,t.VERTEX_SHADER,e),s=I(t,t.FRAGMENT_SHADER,n),i=t.createProgram();return t.attachShader(i,o),t.attachShader(i,s),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)?i:(console.error(t.getProgramInfoLog(i)||"Program link error"),t.deleteProgram(i),null)}const ne=`#version 300 es
precision highp float;
layout(location=0) in vec3 a_position;
layout(location=1) in vec3 a_color;
layout(location=2) in vec3 a_offset; // per-instance world-space offset
uniform mat4 u_vp;     // view-projection
uniform mat4 u_model;  // model rotation only
out vec3 v_color;
void main(){
  v_color = a_color;
  vec3 rotated = (u_model * vec4(a_position, 1.0)).xyz;
  vec3 worldPos = rotated + a_offset;
  gl_Position = u_vp * vec4(worldPos, 1.0);
}`,se=`#version 300 es
precision highp float;
in vec3 v_color;
out vec4 outColor;
void main(){
  outColor = vec4(v_color, 1.0);
}`,W=oe(r,ne,se);r.useProgram(W);const E=new Float32Array([1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1,-1,1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1]),ie=new Float32Array([1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,1,1,0,1,1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0,1,1,0,1,1]),z=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),G=r.createVertexArray();r.bindVertexArray(G);const H=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,H);r.bufferData(r.ARRAY_BUFFER,E,r.DYNAMIC_DRAW);r.enableVertexAttribArray(0);r.vertexAttribPointer(0,3,r.FLOAT,!1,0,0);const ae=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,ae);r.bufferData(r.ARRAY_BUFFER,ie,r.STATIC_DRAW);r.enableVertexAttribArray(1);r.vertexAttribPointer(1,3,r.FLOAT,!1,0,0);const le=r.createBuffer();r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,le);r.bufferData(r.ELEMENT_ARRAY_BUFFER,z,r.STATIC_DRAW);const O=r.getUniformLocation(W,"u_vp"),k=r.getUniformLocation(W,"u_model");r.enable(r.DEPTH_TEST);r.clearColor(.03,.03,.05,1);function ce(){const t=Math.min(window.devicePixelRatio||1,2),e=Math.floor(l.clientWidth*t),n=Math.floor(l.clientHeight*t);(l.width!==e||l.height!==n)&&(l.width=e,l.height=n),r.viewport(0,0,l.width,l.height)}const u=document.createElement("div");u.style.position="fixed";u.style.left="8px";u.style.top="8px";u.style.padding="4px 6px";u.style.background="rgba(0,0,0,0.5)";u.style.color="#0f0";u.style.fontFamily="monospace";u.style.fontSize="12px";u.style.zIndex="1000";u.style.pointerEvents="none";document.body.appendChild(u);const p=[];let _=performance.now();function fe(t){const e=t-_;_=t,p.push(e);let n=0;for(let c=p.length-1;c>=0;c--)if(n+=p[c],n>1e3){p.splice(0,c);break}const o=p.length;if(o===0)return;const i=1e3/(p.reduce((c,R)=>c+R,0)/o),a=p.map(c=>1e3/Math.max(1e-4,c)).sort((c,R)=>c-R),f=Math.max(0,Math.floor(.01*o)-1),d=a[f];u.textContent=`fps ${i.toFixed(1)} | 1% ${d.toFixed(1)}`}let v=256,h=0;const P=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,P);r.bufferData(r.ARRAY_BUFFER,v*3*4,r.DYNAMIC_DRAW);r.enableVertexAttribArray(2);r.vertexAttribPointer(2,3,r.FLOAT,!1,0,0);r.vertexAttribDivisor(2,1);let m=new Float32Array(v*3);function ue(t){if(t<=v)return;let e=v;for(;e<t;)e*=2;const n=new Float32Array(e*3);n.set(m.subarray(0,h*3)),m=n,v=e,r.bindBuffer(r.ARRAY_BUFFER,P),r.bufferData(r.ARRAY_BUFFER,v*3*4,r.DYNAMIC_DRAW),h>0&&r.bufferSubData(r.ARRAY_BUFFER,0,m.subarray(0,h*3))}function q(t){ue(h+1);const e=h*3;m[e]=t[0],m[e+1]=t[1],m[e+2]=t[2],r.bindBuffer(r.ARRAY_BUFFER,P),r.bufferSubData(r.ARRAY_BUFFER,e*4,m.subarray(e,e+3)),h++}function de(){h<=0||h--}let S=4;const F=50;let he=0;function Y(t,e){let n=1,o=0,s=t;for(;s>0;)n/=e,o+=n*(s%e),s=Math.floor(s/e);return o}function K(){const t=++he,e=Y(t,2),n=Y(t,3),o=-e,s=2*Math.PI*n,i=Math.sqrt(Math.max(0,1-o*o)),a=i*Math.cos(s),f=i*Math.sin(s),d=o,c=a*F,R=f*F,X=S+d*F;return[c,R,X]}let N=0,V=0,g=1;const pe=200;let B=0,y=0;C.on("scrollWheel",({direction:t,event:e})=>{const n=performance.now(),o=t==="up"?1:-1;o===V&&n-N<pe?g+=1:g=1,N=n,V=o,B+=o*g});for(let t=0;t<10;t++)q(K());function j(t){ce();const e=t*.001,n=Math.max(0,Math.min(.1,(t-_)*.001)),o=Math.exp(-4*n);B*=o,y+=B*n;let s=0;if(y>=1?(s=Math.floor(y),y-=s):y<=-1&&(s=Math.ceil(y),y-=s),s>0)for(let a=0;a<s;a++)q(K());else if(s<0)for(let a=0;a<-s;a++)de();r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);const i=l.width/Math.max(1,l.height);if(A&&!x&&(x=!0,w.postMessage({type:"compute",timeSec:e*b,aspect:i,cameraDistance:S})),M&&L)r.uniformMatrix4fv(O,!1,M),r.uniformMatrix4fv(k,!1,L);else{const a=Z(Math.PI/3,i,.1,100);let f=T();f=ee(f,[0,0,-S]);let d=T();d=re(d,e*b),d=te(d,e*.7*b);const c=U(a,f);r.uniformMatrix4fv(O,!1,c),r.uniformMatrix4fv(k,!1,d)}A&&ve(e*b),r.bindVertexArray(G),r.drawElementsInstanced(r.TRIANGLES,z.length,r.UNSIGNED_SHORT,0,Math.max(1,h)),requestAnimationFrame(j)}function ye(){l.style.width||(l.style.width="100vw"),l.style.height||(l.style.height="100vh"),l.style.display="block"}ye();fe(performance.now());requestAnimationFrame(j);let b=1;C.on("sideButton",()=>{b*=-1});let w,A=!1,x=!1,M=null,L=null,D=!1;function me(){try{const t=E.buffer.slice(0);w.postMessage({type:"initGeometry",buffer:t,length:E.length},[t])}catch{}}function Ae(){try{w=new Worker(new URL(""+new URL("worker-BAEKGTU-.js",import.meta.url).href,import.meta.url),{type:"module"}),w.onmessage=t=>{const e=t.data;if(e){if(e.type==="result"){const{vp:n,model:o}=e;n&&n.buffer&&(M=new Float32Array(n.buffer,n.byteOffset||0,(n.byteLength||16*4)/4)),o&&o.buffer&&(L=new Float32Array(o.buffer,o.byteOffset||0,(o.byteLength||16*4)/4)),x=!1,A=!0}else if(e.type==="initAck")A=!0;else if(e.type==="transformResult"){const{buffer:n,byteOffset:o=0,byteLength:s}=e.positions||{};if(n&&s===E.byteLength){const i=new Float32Array(n,o,E.length);r.bindBuffer(r.ARRAY_BUFFER,H),r.bufferSubData(r.ARRAY_BUFFER,0,i)}D=!1}}},w.onerror=()=>{A=!1}}catch{A=!1}}Ae();me();function ve(t){!A||D||(D=!0,w.postMessage({type:"transform",timeSec:t}))}
