(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function r(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=r(i);fetch(i.href,n)}})();class Ce{constructor(){this.sideButtonEnabled=!0,this.scrollWheelEnabled=!0,this.eventListeners=new Map}init(t={}){this.sideButtonEnabled=t.sideButtonEnabled??!0,this.scrollWheelEnabled=t.scrollWheelEnabled??!0,this.sideButtonEnabled&&this.setupSideButtonListener(),this.scrollWheelEnabled&&this.setupScrollWheelListener(),t.keyboardFallback!==!1&&this.setupKeyboardFallback()}setupSideButtonListener(){window.addEventListener("sideClick",t=>{this.sideButtonEnabled&&this.handleSideButtonClick(t)})}setupScrollWheelListener(){window.addEventListener("scrollUp",t=>{this.scrollWheelEnabled&&this.handleScrollWheel({direction:"up",event:t})}),window.addEventListener("scrollDown",t=>{this.scrollWheelEnabled&&this.handleScrollWheel({direction:"down",event:t})})}setupKeyboardFallback(){window.addEventListener("keydown",t=>{if(t.code==="Space"){t.preventDefault();const r=new CustomEvent("sideClick",{detail:{source:"keyboard"}});window.dispatchEvent(r)}})}handleSideButtonClick(t){(this.eventListeners.get("sideButton")||[]).forEach(s=>s(t))}handleScrollWheel(t){(this.eventListeners.get("scrollWheel")||[]).forEach(s=>s({direction:t.direction,event:t.event}))}on(t,r){this.eventListeners.has(t)||this.eventListeners.set(t,[]),this.eventListeners.get(t).push(r)}off(t,r){const s=this.eventListeners.get(t)||[],i=s.indexOf(r);i>-1&&s.splice(i,1)}}const Re=new Ce;class Ue{constructor(){this.screenWidth=240}setupViewport(){let t=document.querySelector('meta[name="viewport"]');t||(t=document.createElement("meta"),t.name="viewport",document.head.appendChild(t)),t.content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"}}const ke=new Ue;ke.setupViewport();Re.init();const d=document.getElementById("glcanvas"),e=d.getContext("webgl2",{antialias:!0});e||console.error("WebGL2 not supported");const C=240,z=320;function be(o,t,r){const s=o.createShader(t);return o.shaderSource(s,r),o.compileShader(s),o.getShaderParameter(s,o.COMPILE_STATUS)?s:(console.error(o.getShaderInfoLog(s)||"Shader compile error"),o.deleteShader(s),null)}function _e(o,t,r){const s=be(o,o.VERTEX_SHADER,t),i=be(o,o.FRAGMENT_SHADER,r),n=o.createProgram();return o.attachShader(n,s),o.attachShader(n,i),o.linkProgram(n),o.getProgramParameter(n,o.LINK_STATUS)?n:(console.error(o.getProgramInfoLog(n)||"Program link error"),o.deleteProgram(n),null)}const Ie=`#version 300 es
precision highp float;
layout(location=0) in vec2 a_pos;       // unit quad verts [-0.5,0.5]
layout(location=1) in vec2 a_instPos;   // world center
layout(location=2) in vec2 a_instSize;  // world size
layout(location=3) in vec4 a_color;
uniform vec2 u_worldSize;
out vec4 v_color;
void main(){
  vec2 world = a_instPos + a_pos * a_instSize;
  vec2 ndc = (world / u_worldSize) * 2.0 - 1.0;
  ndc.y = -ndc.y; // flip Y to screen coords
  gl_Position = vec4(ndc, 0.0, 1.0);
  v_color = a_color;
}`,We=`#version 300 es
precision highp float;
in vec4 v_color;
out vec4 outColor;
void main(){ outColor = v_color; }`,de=_e(e,Ie,We);e.useProgram(de);const ce=e.createTexture(),we=e.createFramebuffer();let ee=0,te=0;function Oe(){ee===d.width&&te===d.height||(ee=d.width,te=d.height,e.bindTexture(e.TEXTURE_2D,ce),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,ee,te,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindFramebuffer(e.FRAMEBUFFER,we),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,ce,0),e.bindFramebuffer(e.FRAMEBUFFER,null))}const Ye=`#version 300 es
precision highp float;
out vec4 outColor;
in vec2 v_uv;
uniform sampler2D u_tex;
uniform float u_threshold;
uniform float u_bloom;
void main(){
  vec2 texel = 1.0 / vec2(textureSize(u_tex, 0));
  vec3 c = texture(u_tex, v_uv).rgb;
  vec3 sum = vec3(0.0);
  // 9-tap blur around
  for (int dy = -1; dy <= 1; ++dy) {
    for (int dx = -1; dx <= 1; ++dx) {
      vec2 uv = v_uv + vec2(float(dx), float(dy)) * texel * 1.5;
      vec3 s = texture(u_tex, uv).rgb;
      float b = max(0.0, max(max(s.r, s.g), s.b) - u_threshold);
      sum += s * b;
    }
  }
  sum /= 9.0;
  vec3 outc = c + sum * u_bloom;
  outColor = vec4(outc, 1.0);
}`,ze=`#version 300 es
precision highp float;
layout(location=0) in vec2 a_pos;
out vec2 v_uv;
void main(){
  v_uv = a_pos * 0.5 + 0.5;
  gl_Position = vec4(a_pos, 0.0, 1.0);
}`,Q=_e(e,ze,Ye),Xe=e.getUniformLocation(Q,"u_threshold"),He=e.getUniformLocation(Q,"u_bloom"),Ne=e.getUniformLocation(Q,"u_tex"),Fe=e.createVertexArray();e.bindVertexArray(Fe);const Ge=new Float32Array([-1,-1,1,-1,1,1,-1,-1,1,1,-1,1]),Ve=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,Ve);e.bufferData(e.ARRAY_BUFFER,Ge,e.STATIC_DRAW);e.enableVertexAttribArray(0);e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0);const Ke=new Float32Array([-.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5]),Be=e.createVertexArray();e.bindVertexArray(Be);const qe=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,qe);e.bufferData(e.ARRAY_BUFFER,Ke,e.STATIC_DRAW);e.enableVertexAttribArray(0);e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0);const Te=e.createBuffer(),Le=e.createBuffer(),De=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,Te);e.enableVertexAttribArray(1);e.vertexAttribPointer(1,2,e.FLOAT,!1,0,0);e.vertexAttribDivisor(1,1);e.bindBuffer(e.ARRAY_BUFFER,Le);e.enableVertexAttribArray(2);e.vertexAttribPointer(2,2,e.FLOAT,!1,0,0);e.vertexAttribDivisor(2,1);e.bindBuffer(e.ARRAY_BUFFER,De);e.enableVertexAttribArray(3);e.vertexAttribPointer(3,4,e.FLOAT,!1,0,0);e.vertexAttribDivisor(3,1);const $e=e.getUniformLocation(de,"u_worldSize");e.disable(e.DEPTH_TEST);e.clearColor(.02,.02,.03,1);function je(){const o=Math.min(window.devicePixelRatio||1,2),t=Math.floor(d.clientWidth*o),r=Math.floor(d.clientHeight*o);(d.width!==t||d.height!==r)&&(d.width=t,d.height=r),e.viewport(0,0,d.width,d.height)}let X=2654435769,H=608135816;function fe(o){X=(o^2654435769)>>>0,H=o*1664525+1013904223>>>0}function pe(){let o=(H+=1831565813)>>>0,t=(X+=2246822507)>>>0;return o^=o>>>15,o=Math.imul(o,739982445),o^=o>>>12,o=Math.imul(o,695872825),o^=o>>>15,t^=t>>>15,t=Math.imul(t,739982445),t^=t>>>12,t=Math.imul(t,695872825),t^=t>>>15,((o^t)>>>0)/4294967295}const ne=50,oe=30,W=28,N=6,y=4;let A=C*.5,k=z-16,U=0;const Ze=140,ae=[],B=[];function Je(){return ae.length>0?ae.pop():{x:0,y:0,vx:0,vy:0}}function Qe(o){ae.push(o)}const le=[],I=[];function et(){return le.length?le.pop():{x:0,y:0,w:8,h:8,vy:30,type:0}}function Ee(o){le.push(o)}const S=[];function tt(o,t,r){let s=(o|0)*374761393^(t|0)*668265263^(r|0);return s=(s^s>>>13)>>>0,s=Math.imul(s,1274126177)>>>0,(s>>>0)/4294967295}function se(o){return Math.floor(pe()*o)}let Z=12345,V=1,K=!1,F={bg:[.02,.02,.03],brick1:[.9,.4,.4],brick2:[.4,.9,.5],brick3:[.4,.6,.9],paddle:[1,1,1],ball:[1,1,.3]};function nt(o){S.length=0;const t=8,r=10,s=C-t*2,i=z*.6,n=s/ne,c=i/oe,m=t,b=r,f=25,w=15,{mask:T,width:a,height:_}=ot(f,w,o^666745);for(let v=0;v<oe;v++)for(let L=0;L<ne;L++){const M=m+L*n+n*.5,P=b+v*c+c*.5,x=Math.max(0,Math.min(a-1,Math.floor((L+.5)/ne*a))),h=Math.max(0,Math.min(_-1,Math.floor((v+.5)/oe*_))),p=T[h*a+x]===1,l=1+(L+v+(o&7))%3;S.push({x:M,y:P,w:n*.95,h:c*.9,hp:p?l:0,alive:p})}}function ot(o,t,r){const s=o*2+1,i=t*2+1,n=new Uint8Array(s*i);for(let h=0;h<s*i;h++)n[h]=1;const c=X,m=H;fe(r);const b=new Uint8Array(o*t),f=[];function w(h,u){return u*o+h}function T(h,u){n[(u*2+1)*s+(h*2+1)]=0}function a(h,u,p,l){n[(u+l+1)*s+(h+p+1)]=0}let _=se(o),v=se(t);for(b[w(_,v)]=1,T(_,v),f.push([_,v]);f.length;){const h=f[f.length-1];_=h[0],v=h[1];const u=[[1,0],[-1,0],[0,1],[0,-1]];for(let l=u.length-1;l>0;l--){const E=se(l+1),D=u[l];u[l]=u[E],u[E]=D}let p=!1;for(let l=0;l<4;l++){const E=u[l][0],D=u[l][1],g=_+E,R=v+D;if(!(g<0||R<0||g>=o||R>=t)&&!b[w(g,R)]){b[w(g,R)]=1,T(g,R),a(_,v,g,R),f.push([g,R]),p=!0;break}}p||f.pop()}const L=0,M=0,P=o-1,x=t-1;return T(L,M),T(P,x),n[(M*2+1)*s+0]=0,n[(x*2+1)*s+(s-1)]=0,X=c,H=m,{mask:n,width:s,height:i}}function me(o,t,r=120,s=-Math.PI/4){const i=Je();i.x=o,i.y=t,i.vx=Math.cos(s)*r,i.vy=Math.sin(s)*r,B.push(i)}function st(o){for(let r=0;r<o&&B.length<5e3;r++){const s=-Math.PI*.75+pe()*(Math.PI*.5);me(A,k-16,110,s)}}let J=3,he=!1;function G(o,t){V=o;const r=(Z^o*2654435769)>>>0;I.length=0,fe(r),F=at(r),nt(r),B.length=0,me(A,k-20,120,-Math.PI*.6),t&&(J=3,he=!1)}class Y{constructor(t,r,s,i,n=0,c=6,m=12){this.x=t,this.y=r,this.w=s,this.h=i,this.depth=n,this.maxDepth=c,this.cap=m,this.items=[],this.kids=null}insert(t){if(this.kids){this._insertIntoKids(t);return}this.items.push(t),this.items.length>this.cap&&this.depth<this.maxDepth&&this._split()}_split(){const t=this.w*.5,r=this.h*.5;this.kids=[new Y(this.x,this.y,t,r,this.depth+1,this.maxDepth,this.cap),new Y(this.x+t,this.y,t,r,this.depth+1,this.maxDepth,this.cap),new Y(this.x,this.y+r,t,r,this.depth+1,this.maxDepth,this.cap),new Y(this.x+t,this.y+r,t,r,this.depth+1,this.maxDepth,this.cap)];const s=this.items;this.items=[];for(let i=0;i<s.length;i++)this._insertIntoKids(s[i])}_insertIntoKids(t){for(let r=0;r<4;r++){const s=this.kids[r];t.rx1>s.x&&t.rx0<s.x+s.w&&t.ry1>s.y&&t.ry0<s.y+s.h&&s.insert(t)}}query(t,r,s,i,n){if(s<=this.x||t>=this.x+this.w||i<=this.y||r>=this.y+this.h)return n;for(let c=0;c<this.items.length;c++)n.push(this.items[c]);if(this.kids)for(let c=0;c<4;c++)this.kids[c].query(t,r,s,i,n);return n}}let ue=null;function it(){ue=new Y(0,0,C,z);for(let o=0;o<S.length;o++){const t=S[o];t.alive&&ue.insert({rx0:t.x-t.w*.5,ry0:t.y-t.h*.5,rx1:t.x+t.w*.5,ry1:t.y+t.h*.5,ref:o})}}function rt(o){Me&&(U=0),A+=U*o;const t=Math.exp(-6*o);U*=t;const r=W*.5;A<r&&(A=r,U=Math.abs(U)),A>C-r&&(A=C-r,U=-Math.abs(U)),it();for(let i=0;i<B.length;i++){const n=B[i];if(n.x+=n.vx*o,n.y+=n.vy*o,n.x<y*.5&&(n.x=y*.5,n.vx*=-1),n.x>C-y*.5&&(n.x=C-y*.5,n.vx*=-1),n.y<y*.5&&(n.y=y*.5,n.vy*=-1),n.y>z+20){Qe(n),B.splice(i,1),i--;continue}const c=A-W*.5,m=A+W*.5,b=k-N*.5,f=k+N*.5;if(n.x+y*.5>c&&n.x-y*.5<m&&n.y+y*.5>b&&n.y-y*.5<f){n.y=b-y*.5,n.vy=-Math.abs(n.vy);const w=(n.x-A)/(W*.5);n.vx=w*120}}for(let i=0;i<B.length;i++){const n=B[i],c=n.x-y*.5,m=n.x+y*.5,b=n.y-y*.5,f=n.y+y*.5,w=[];ue.query(c,b,m,f,w);for(let T=0;T<w.length;T++){const a=S[w[T].ref];if(!a||!a.alive)continue;const _=a.x-a.w*.5,v=a.x+a.w*.5,L=a.y-a.h*.5,M=a.y+a.h*.5;if(m>_&&c<v&&f>L&&b<M){const P=m-_,x=v-c,h=f-L,u=M-b,p=Math.min(P,x),l=Math.min(h,u);if(p<l?(n.vx*=-1,n.x+=(P<x?-p:p)*.5*Math.sign(n.vx||1)):(n.vy*=-1,n.y+=(h<u?-l:l)*.5*Math.sign(n.vy||1)),a.hp-=1,Pe+=10,a.hp<=0&&(a.alive=!1,pe()<.6)){const E=et();E.x=a.x,E.y=a.y,E.w=8,E.h=8,E.vy=40,E.type=1,I.push(E)}break}}}for(let i=0;i<I.length;i++){const n=I[i];if(n.y+=n.vy*o,n.y>z+10){Ee(n),I.splice(i,1),i--;continue}const c=A-W*.5,m=A+W*.5,b=k-N*.5,f=k+N*.5;if(n.x+n.w*.5>c&&n.x-n.w*.5<m&&n.y+n.h*.5>b&&n.y-n.h*.5<f){st(16),Ee(n),I.splice(i,1),i--;continue}}B.length===0&&!he&&(J-=1,J>0?me(A,k-20,120,-Math.PI*.5):(he=!0,O&&$&&j?($.textContent="Game Over",O.style.display="flex",j.style.display="inline-block",j.onclick=()=>{O.style.display="none",j.style.display="none",Z=Math.random()*1e9|0,G(1,!0)}):(Z=Math.random()*1e9|0,G(1,!0))));let s=0;for(let i=0;i<S.length;i++)S[i].alive&&s++;s===0&&!K&&(K=!0,O&&$?($.textContent=`Level ${V} cleared!`,O.style.display="flex",setTimeout(()=>{O.style.display="none",K=!1,G(V+1,!1)},1e3)):(K=!1,G(V+1,!1)))}const ve=[],xe=[],ye=[];function q(o,t,r,s,i,n,c,m){ve.push(o,t),xe.push(r,s),ye.push(i,n,c,m)}function ct(){const o=new Float32Array(ve),t=new Float32Array(xe),r=new Float32Array(ye);e.bindBuffer(e.ARRAY_BUFFER,Te),e.bufferData(e.ARRAY_BUFFER,o,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,Le),e.bufferData(e.ARRAY_BUFFER,t,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,De),e.bufferData(e.ARRAY_BUFFER,r,e.DYNAMIC_DRAW),e.drawArraysInstanced(e.TRIANGLES,0,6,o.length/2)}function at(o){const t=X,r=H;fe(o^3203338804);const s=.61803398875;let i=tt(1,2,o)*360%360;function n(_,v,L){const M=(_%360+360)%360/360,P=Math.min(1,Math.max(0,v)),x=L,h=Math.floor(M*6),u=M*6-h,p=x*(1-P),l=x*(1-u*P),E=x*(1-(1-u)*P);let D,g,R;switch(h%6){case 0:D=x,g=E,R=p;break;case 1:D=l,g=x,R=p;break;case 2:D=p,g=x,R=E;break;case 3:D=p,g=l,R=x;break;case 4:D=E,g=p,R=x;break;case 5:D=x,g=p,R=l;break}return[D,g,R]}function c(){return i=(i+s*360)%360,i}const m=n(i,.08,.06),b=n(c(),.85,.75),f=n(c(),.95,.78),w=n(c(),.9,.82),T=n(c(),.1,.98),a=n(c(),.3,.98);return X=t,H=r,{bg:m,brick1:b,brick2:f,brick3:w,paddle:T,ball:a}}const Ae=document.getElementById("hud"),lt=document.getElementById("menu"),O=document.getElementById("overlay"),ie=document.getElementById("seed-input"),re=document.getElementById("btn-start"),$=document.getElementById("overlay-text"),j=document.getElementById("btn-restart");let Me=!0,Pe=0;re==null||re.addEventListener("click",()=>{Z=parseInt((ie==null?void 0:ie.value)||"12345",10)||12345,G(1,!0),Me=!1,lt.style.display="none"});let ge=performance.now();function Se(o){je(),Oe();const t=Math.min(.05,Math.max(0,(o-ge)*.001));ge=o,rt(t),e.bindFramebuffer(e.FRAMEBUFFER,we),e.clear(e.COLOR_BUFFER_BIT),e.clearColor(F.bg[0],F.bg[1],F.bg[2],1),e.useProgram(de),e.uniform2f($e,C,z),e.bindVertexArray(Be),ve.length=0,xe.length=0,ye.length=0;for(let r=0;r<S.length;r++){const s=S[r];if(!s.alive)continue;const i=s.hp===1?F.brick1:s.hp===2?F.brick2:F.brick3;q(s.x,s.y,s.w,s.h,i[0],i[1],i[2],1)}q(A,k,W,N,F.paddle[0],F.paddle[1],F.paddle[2],1);for(let r=0;r<B.length;r++){const s=B[r];q(s.x,s.y,y,y,F.ball[0],F.ball[1],F.ball[2],1)}for(let r=0;r<I.length;r++){const s=I[r];q(s.x,s.y,s.w,s.h,.2,1,.6,1)}ct(),e.bindFramebuffer(e.FRAMEBUFFER,null),e.useProgram(Q),e.bindVertexArray(Fe),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,ce),e.uniform1i(Ne,0),e.uniform1f(Xe,.5),e.uniform1f(He,1.1),e.drawArrays(e.TRIANGLES,0,6),Ae&&(Ae.textContent=`Lvl ${V}  Lives ${J}  Balls ${B.length}  Score ${Pe}`),requestAnimationFrame(Se)}Re.on("scrollWheel",({direction:o})=>{U+=(o==="up"?-1:1)*Ze});window.addEventListener("mousemove",o=>{const t=d.getBoundingClientRect();A=(o.clientX-t.left)/Math.max(1,t.width)*C});function ht(){d.style.width||(d.style.width="100vw"),d.style.height||(d.style.height="100vh"),d.style.display="block"}ht();requestAnimationFrame(Se);window.BB_DEBUG={getStats:()=>({paddleX:A,balls:B.length,bricksAlive:S.reduce((o,t)=>o+(t.alive?1:0),0)})};
