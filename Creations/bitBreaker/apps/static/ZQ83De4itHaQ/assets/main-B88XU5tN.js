(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();class Ue{constructor(){this.sideButtonEnabled=!0,this.scrollWheelEnabled=!0,this.eventListeners=new Map}init(t={}){this.sideButtonEnabled=t.sideButtonEnabled??!0,this.scrollWheelEnabled=t.scrollWheelEnabled??!0,this.sideButtonEnabled&&this.setupSideButtonListener(),this.scrollWheelEnabled&&this.setupScrollWheelListener(),t.keyboardFallback!==!1&&this.setupKeyboardFallback()}setupSideButtonListener(){window.addEventListener("sideClick",t=>{this.sideButtonEnabled&&this.handleSideButtonClick(t)})}setupScrollWheelListener(){window.addEventListener("scrollUp",t=>{this.scrollWheelEnabled&&this.handleScrollWheel({direction:"up",event:t})}),window.addEventListener("scrollDown",t=>{this.scrollWheelEnabled&&this.handleScrollWheel({direction:"down",event:t})})}setupKeyboardFallback(){window.addEventListener("keydown",t=>{if(t.code==="Space"){t.preventDefault();const r=new CustomEvent("sideClick",{detail:{source:"keyboard"}});window.dispatchEvent(r)}})}handleSideButtonClick(t){(this.eventListeners.get("sideButton")||[]).forEach(s=>s(t))}handleScrollWheel(t){(this.eventListeners.get("scrollWheel")||[]).forEach(s=>s({direction:t.direction,event:t.event}))}on(t,r){this.eventListeners.has(t)||this.eventListeners.set(t,[]),this.eventListeners.get(t).push(r)}off(t,r){const s=this.eventListeners.get(t)||[],i=s.indexOf(r);i>-1&&s.splice(i,1)}}const _e=new Ue;class ke{constructor(){this.screenWidth=240}setupViewport(){let t=document.querySelector('meta[name="viewport"]');t||(t=document.createElement("meta"),t.name="viewport",document.head.appendChild(t)),t.content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"}}const Ie=new ke;Ie.setupViewport();_e.init();const d=document.getElementById("glcanvas"),e=d.getContext("webgl2",{antialias:!0});e||console.error("WebGL2 not supported");const C=240,z=320;function be(n,t,r){const s=n.createShader(t);return n.shaderSource(s,r),n.compileShader(s),n.getShaderParameter(s,n.COMPILE_STATUS)?s:(console.error(n.getShaderInfoLog(s)||"Shader compile error"),n.deleteShader(s),null)}function we(n,t,r){const s=be(n,n.VERTEX_SHADER,t),i=be(n,n.FRAGMENT_SHADER,r),o=n.createProgram();return n.attachShader(o,s),n.attachShader(o,i),n.linkProgram(o),n.getProgramParameter(o,n.LINK_STATUS)?o:(console.error(n.getProgramInfoLog(o)||"Program link error"),n.deleteProgram(o),null)}const We=`#version 300 es
precision highp float;
layout(location=0) in vec2 a_pos;       // unit quad verts [-0.5,0.5]
layout(location=1) in vec2 a_instPos;   // world center
layout(location=2) in vec2 a_instSize;  // world size
layout(location=3) in vec4 a_color;
uniform vec2 u_worldSize;
out vec4 v_color;
void main(){
  vec2 world = a_instPos + a_pos * a_instSize;
  vec2 ndc = (world / u_worldSize) * 2.0 - 1.0;
  ndc.y = -ndc.y; // flip Y to screen coords
  gl_Position = vec4(ndc, 0.0, 1.0);
  v_color = a_color;
}`,Oe=`#version 300 es
precision highp float;
in vec4 v_color;
out vec4 outColor;
void main(){ outColor = v_color; }`,de=we(e,We,Oe);e.useProgram(de);const ce=e.createTexture(),Fe=e.createFramebuffer();let ee=0,te=0;function Ye(){ee===d.width&&te===d.height||(ee=d.width,te=d.height,e.bindTexture(e.TEXTURE_2D,ce),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,ee,te,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindFramebuffer(e.FRAMEBUFFER,Fe),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,ce,0),e.bindFramebuffer(e.FRAMEBUFFER,null))}const ze=`#version 300 es
precision highp float;
out vec4 outColor;
in vec2 v_uv;
uniform sampler2D u_tex;
uniform float u_threshold;
uniform float u_bloom;
void main(){
  vec2 texel = 1.0 / vec2(textureSize(u_tex, 0));
  vec3 c = texture(u_tex, v_uv).rgb;
  vec3 sum = vec3(0.0);
  // 9-tap blur around
  for (int dy = -1; dy <= 1; ++dy) {
    for (int dx = -1; dx <= 1; ++dx) {
      vec2 uv = v_uv + vec2(float(dx), float(dy)) * texel * 1.5;
      vec3 s = texture(u_tex, uv).rgb;
      float b = max(0.0, max(max(s.r, s.g), s.b) - u_threshold);
      sum += s * b;
    }
  }
  sum /= 9.0;
  vec3 outc = c + sum * u_bloom;
  outColor = vec4(outc, 1.0);
}`,Xe=`#version 300 es
precision highp float;
layout(location=0) in vec2 a_pos;
out vec2 v_uv;
void main(){
  v_uv = a_pos * 0.5 + 0.5;
  gl_Position = vec4(a_pos, 0.0, 1.0);
}`,Q=we(e,Xe,ze),He=e.getUniformLocation(Q,"u_threshold"),Ne=e.getUniformLocation(Q,"u_bloom"),Ge=e.getUniformLocation(Q,"u_tex"),Be=e.createVertexArray();e.bindVertexArray(Be);const Ve=new Float32Array([-1,-1,1,-1,1,1,-1,-1,1,1,-1,1]),Ke=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,Ke);e.bufferData(e.ARRAY_BUFFER,Ve,e.STATIC_DRAW);e.enableVertexAttribArray(0);e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0);const qe=new Float32Array([-.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5]),Te=e.createVertexArray();e.bindVertexArray(Te);const $e=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,$e);e.bufferData(e.ARRAY_BUFFER,qe,e.STATIC_DRAW);e.enableVertexAttribArray(0);e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0);const Le=e.createBuffer(),De=e.createBuffer(),Me=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,Le);e.enableVertexAttribArray(1);e.vertexAttribPointer(1,2,e.FLOAT,!1,0,0);e.vertexAttribDivisor(1,1);e.bindBuffer(e.ARRAY_BUFFER,De);e.enableVertexAttribArray(2);e.vertexAttribPointer(2,2,e.FLOAT,!1,0,0);e.vertexAttribDivisor(2,1);e.bindBuffer(e.ARRAY_BUFFER,Me);e.enableVertexAttribArray(3);e.vertexAttribPointer(3,4,e.FLOAT,!1,0,0);e.vertexAttribDivisor(3,1);const je=e.getUniformLocation(de,"u_worldSize");e.disable(e.DEPTH_TEST);e.clearColor(.02,.02,.03,1);function Ze(){const n=Math.min(window.devicePixelRatio||1,2),t=Math.floor(d.clientWidth*n),r=Math.floor(d.clientHeight*n);(d.width!==t||d.height!==r)&&(d.width=t,d.height=r),e.viewport(0,0,d.width,d.height)}let X=2654435769,H=608135816;function fe(n){X=(n^2654435769)>>>0,H=n*1664525+1013904223>>>0}function pe(){let n=(H+=1831565813)>>>0,t=(X+=2246822507)>>>0;return n^=n>>>15,n=Math.imul(n,739982445),n^=n>>>12,n=Math.imul(n,695872825),n^=n>>>15,t^=t>>>15,t=Math.imul(t,739982445),t^=t>>>12,t=Math.imul(t,695872825),t^=t>>>15,((n^t)>>>0)/4294967295}const ne=50,oe=30,W=28,N=6,y=4;let A=C*.5,k=z-16,U=0;const Je=140,le=[],B=[];function Qe(){return le.length>0?le.pop():{x:0,y:0,vx:0,vy:0}}function et(n){le.push(n)}const ae=[],I=[];function tt(){return ae.length?ae.pop():{x:0,y:0,w:8,h:8,vy:30,type:0}}function Ee(n){ae.push(n)}const S=[];function nt(n,t,r){let s=(n|0)*374761393^(t|0)*668265263^(r|0);return s=(s^s>>>13)>>>0,s=Math.imul(s,1274126177)>>>0,(s>>>0)/4294967295}function se(n){return Math.floor(pe()*n)}let Z=12345,V=1,K=!1,F={bg:[.02,.02,.03],brick1:[.9,.4,.4],brick2:[.4,.9,.5],brick3:[.4,.6,.9],paddle:[1,1,1],ball:[1,1,.3]};function ot(n){S.length=0;const t=8,r=10,s=C-t*2,i=z*.6,o=s/ne,c=i/oe,m=t,b=r,f=16,w=10,{mask:T,width:l,height:_}=st(f,w,n^666745);for(let v=0;v<oe;v++)for(let L=0;L<ne;L++){const M=m+L*o+o*.5,P=b+v*c+c*.5,x=Math.max(0,Math.min(l-1,Math.floor((L+.5)/ne*l))),h=Math.max(0,Math.min(_-1,Math.floor((v+.5)/oe*_))),p=T[h*l+x]===1,a=1+(L+v+(n&7))%3;S.push({x:M,y:P,w:o*.95,h:c*.9,hp:p?a:0,alive:p})}}function st(n,t,r){const s=n*2+1,i=t*2+1,o=new Uint8Array(s*i);for(let h=0;h<s*i;h++)o[h]=1;const c=X,m=H;fe(r);const b=new Uint8Array(n*t),f=[];function w(h,u){return u*n+h}function T(h,u){o[(u*2+1)*s+(h*2+1)]=0}function l(h,u,p,a){o[(u+a+1)*s+(h+p+1)]=0}let _=se(n),v=se(t);for(b[w(_,v)]=1,T(_,v),f.push([_,v]);f.length;){const h=f[f.length-1];_=h[0],v=h[1];const u=[[1,0],[-1,0],[0,1],[0,-1]];for(let a=u.length-1;a>0;a--){const E=se(a+1),D=u[a];u[a]=u[E],u[E]=D}let p=!1;for(let a=0;a<4;a++){const E=u[a][0],D=u[a][1],g=_+E,R=v+D;if(!(g<0||R<0||g>=n||R>=t)&&!b[w(g,R)]){b[w(g,R)]=1,T(g,R),l(_,v,g,R),f.push([g,R]),p=!0;break}}p||f.pop()}const L=0,M=0,P=n-1,x=t-1;return T(L,M),T(P,x),o[(M*2+1)*s+0]=0,o[(x*2+1)*s+(s-1)]=0,X=c,H=m,{mask:o,width:s,height:i}}function me(n,t,r=120,s=-Math.PI/4){const i=Qe();i.x=n,i.y=t,i.vx=Math.cos(s)*r,i.vy=Math.sin(s)*r,B.push(i)}function it(n){for(let r=0;r<n&&B.length<5e3;r++){const s=-Math.PI*.75+pe()*(Math.PI*.5);me(A,k-16,110,s)}}let J=3,he=!1;function G(n,t){V=n;const r=(Z^n*2654435769)>>>0;I.length=0,fe(r),F=at(r),ot(r),B.length=0,me(A,k-20,120,-Math.PI*.6),t&&(J=3,he=!1)}class Y{constructor(t,r,s,i,o=0,c=6,m=12){this.x=t,this.y=r,this.w=s,this.h=i,this.depth=o,this.maxDepth=c,this.cap=m,this.items=[],this.kids=null}insert(t){if(this.kids){this._insertIntoKids(t);return}this.items.push(t),this.items.length>this.cap&&this.depth<this.maxDepth&&this._split()}_split(){const t=this.w*.5,r=this.h*.5;this.kids=[new Y(this.x,this.y,t,r,this.depth+1,this.maxDepth,this.cap),new Y(this.x+t,this.y,t,r,this.depth+1,this.maxDepth,this.cap),new Y(this.x,this.y+r,t,r,this.depth+1,this.maxDepth,this.cap),new Y(this.x+t,this.y+r,t,r,this.depth+1,this.maxDepth,this.cap)];const s=this.items;this.items=[];for(let i=0;i<s.length;i++)this._insertIntoKids(s[i])}_insertIntoKids(t){for(let r=0;r<4;r++){const s=this.kids[r];t.rx1>s.x&&t.rx0<s.x+s.w&&t.ry1>s.y&&t.ry0<s.y+s.h&&s.insert(t)}}query(t,r,s,i,o){if(s<=this.x||t>=this.x+this.w||i<=this.y||r>=this.y+this.h)return o;for(let c=0;c<this.items.length;c++)o.push(this.items[c]);if(this.kids)for(let c=0;c<4;c++)this.kids[c].query(t,r,s,i,o);return o}}let ue=null;function rt(){ue=new Y(0,0,C,z);for(let n=0;n<S.length;n++){const t=S[n];t.alive&&ue.insert({rx0:t.x-t.w*.5,ry0:t.y-t.h*.5,rx1:t.x+t.w*.5,ry1:t.y+t.h*.5,ref:n})}}function ct(n){Pe&&(U=0),A+=U*n;const t=Math.exp(-6*n);U*=t;const r=W*.5;A<r&&(A=r,U=Math.abs(U)),A>C-r&&(A=C-r,U=-Math.abs(U)),rt();for(let i=0;i<B.length;i++){const o=B[i];if(o.x+=o.vx*n,o.y+=o.vy*n,o.x<y*.5&&(o.x=y*.5,o.vx*=-1),o.x>C-y*.5&&(o.x=C-y*.5,o.vx*=-1),o.y<y*.5&&(o.y=y*.5,o.vy*=-1),o.y>z+20){et(o),B.splice(i,1),i--;continue}const c=A-W*.5,m=A+W*.5,b=k-N*.5,f=k+N*.5;if(o.x+y*.5>c&&o.x-y*.5<m&&o.y+y*.5>b&&o.y-y*.5<f){o.y=b-y*.5,o.vy=-Math.abs(o.vy);const w=(o.x-A)/(W*.5);o.vx=w*120}}for(let i=0;i<B.length;i++){const o=B[i],c=o.x-y*.5,m=o.x+y*.5,b=o.y-y*.5,f=o.y+y*.5,w=[];ue.query(c,b,m,f,w);for(let T=0;T<w.length;T++){const l=S[w[T].ref];if(!l||!l.alive)continue;const _=l.x-l.w*.5,v=l.x+l.w*.5,L=l.y-l.h*.5,M=l.y+l.h*.5;if(m>_&&c<v&&f>L&&b<M){const P=m-_,x=v-c,h=f-L,u=M-b,p=Math.min(P,x),a=Math.min(h,u);if(p<a?(o.vx*=-1,o.x+=(P<x?-p:p)*.5*Math.sign(o.vx||1)):(o.vy*=-1,o.y+=(h<u?-a:a)*.5*Math.sign(o.vy||1)),l.hp-=1,Se+=10,l.hp<=0&&(l.alive=!1,pe()<.6)){const E=tt();E.x=l.x,E.y=l.y,E.w=8,E.h=8,E.vy=40,E.type=1,I.push(E)}break}}}for(let i=0;i<I.length;i++){const o=I[i];if(o.y+=o.vy*n,o.y>z+10){Ee(o),I.splice(i,1),i--;continue}const c=A-W*.5,m=A+W*.5,b=k-N*.5,f=k+N*.5;if(o.x+o.w*.5>c&&o.x-o.w*.5<m&&o.y+o.h*.5>b&&o.y-o.h*.5<f){it(16),Ee(o),I.splice(i,1),i--;continue}}B.length===0&&!he&&(J-=1,J>0?me(A,k-20,120,-Math.PI*.5):(he=!0,O&&$&&j?($.textContent="Game Over",O.style.display="flex",j.style.display="inline-block",j.onclick=()=>{O.style.display="none",j.style.display="none",Z=Math.random()*1e9|0,G(1,!0)}):(Z=Math.random()*1e9|0,G(1,!0))));let s=0;for(let i=0;i<S.length;i++)S[i].alive&&s++;s===0&&!K&&(K=!0,O&&$?($.textContent=`Level ${V} cleared!`,O.style.display="flex",setTimeout(()=>{O.style.display="none",K=!1,G(V+1,!1)},1e3)):(K=!1,G(V+1,!1)))}const ve=[],xe=[],ye=[];function q(n,t,r,s,i,o,c,m){ve.push(n,t),xe.push(r,s),ye.push(i,o,c,m)}function lt(){const n=new Float32Array(ve),t=new Float32Array(xe),r=new Float32Array(ye);e.bindBuffer(e.ARRAY_BUFFER,Le),e.bufferData(e.ARRAY_BUFFER,n,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,De),e.bufferData(e.ARRAY_BUFFER,t,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,Me),e.bufferData(e.ARRAY_BUFFER,r,e.DYNAMIC_DRAW),e.drawArraysInstanced(e.TRIANGLES,0,6,n.length/2)}function at(n){const t=X,r=H;fe(n^3203338804);const s=.61803398875;let i=nt(1,2,n)*360%360;function o(_,v,L){const M=(_%360+360)%360/360,P=Math.min(1,Math.max(0,v)),x=L,h=Math.floor(M*6),u=M*6-h,p=x*(1-P),a=x*(1-u*P),E=x*(1-(1-u)*P);let D,g,R;switch(h%6){case 0:D=x,g=E,R=p;break;case 1:D=a,g=x,R=p;break;case 2:D=p,g=x,R=E;break;case 3:D=p,g=a,R=x;break;case 4:D=E,g=p,R=x;break;case 5:D=x,g=p,R=a;break}return[D,g,R]}function c(){return i=(i+s*360)%360,i}const m=o(i,.08,.06),b=o(c(),.85,.75),f=o(c(),.95,.78),w=o(c(),.9,.82),T=o(c(),.1,.98),l=o(c(),.3,.98);return X=t,H=r,{bg:m,brick1:b,brick2:f,brick3:w,paddle:T,ball:l}}const Ae=document.getElementById("hud"),ht=document.getElementById("menu"),O=document.getElementById("overlay"),ie=document.getElementById("seed-input"),re=document.getElementById("btn-start"),$=document.getElementById("overlay-text"),j=document.getElementById("btn-restart");let Pe=!0,ge=!1,Se=0;re==null||re.addEventListener("click",()=>{Z=parseInt((ie==null?void 0:ie.value)||"12345",10)||12345,G(1,!0),Pe=!1,ht.style.display="none";const n=document.getElementById("glcanvas");n&&(n.style.visibility="visible"),ge||(ge=!0,requestAnimationFrame(Ce))});let Re=performance.now();function Ce(n){Ze(),Ye();const t=Math.min(.05,Math.max(0,(n-Re)*.001));Re=n,ct(t),e.bindFramebuffer(e.FRAMEBUFFER,Fe),e.clear(e.COLOR_BUFFER_BIT),e.clearColor(F.bg[0],F.bg[1],F.bg[2],1),e.useProgram(de),e.uniform2f(je,C,z),e.bindVertexArray(Te),ve.length=0,xe.length=0,ye.length=0;for(let r=0;r<S.length;r++){const s=S[r];if(!s.alive)continue;const i=s.hp===1?F.brick1:s.hp===2?F.brick2:F.brick3;q(s.x,s.y,s.w,s.h,i[0],i[1],i[2],1)}q(A,k,W,N,F.paddle[0],F.paddle[1],F.paddle[2],1);for(let r=0;r<B.length;r++){const s=B[r];q(s.x,s.y,y,y,F.ball[0],F.ball[1],F.ball[2],1)}for(let r=0;r<I.length;r++){const s=I[r];q(s.x,s.y,s.w,s.h,.2,1,.6,1)}lt(),e.bindFramebuffer(e.FRAMEBUFFER,null),e.useProgram(Q),e.bindVertexArray(Be),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,ce),e.uniform1i(Ge,0),e.uniform1f(He,.5),e.uniform1f(Ne,1.1),e.drawArrays(e.TRIANGLES,0,6),Ae&&(Ae.textContent=`Lvl ${V}  Lives ${J}  Balls ${B.length}  Score ${Se}`),requestAnimationFrame(Ce)}_e.on("scrollWheel",({direction:n})=>{U+=(n==="up"?-1:1)*Je});window.addEventListener("mousemove",n=>{const t=d.getBoundingClientRect();A=(n.clientX-t.left)/Math.max(1,t.width)*C});function ut(){d.style.width||(d.style.width="100vw"),d.style.height||(d.style.height="100vh"),d.style.display="block"}ut();window.BB_DEBUG={getStats:()=>({paddleX:A,balls:B.length,bricksAlive:S.reduce((n,t)=>n+(t.alive?1:0),0)})};
