(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const a of l)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function o(l){const a={};return l.integrity&&(a.integrity=l.integrity),l.referrerPolicy&&(a.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?a.credentials="include":l.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(l){if(l.ep)return;l.ep=!0;const a=o(l);fetch(l.href,a)}})();class ${constructor(){this.sideButtonEnabled=!0,this.scrollWheelEnabled=!0,this.eventListeners=new Map}init(e={}){this.sideButtonEnabled=e.sideButtonEnabled??!0,this.scrollWheelEnabled=e.scrollWheelEnabled??!0,this.sideButtonEnabled&&this.setupSideButtonListener(),this.scrollWheelEnabled&&this.setupScrollWheelListener(),e.keyboardFallback!==!1&&this.setupKeyboardFallback()}setupSideButtonListener(){window.addEventListener("sideClick",e=>{this.sideButtonEnabled&&this.handleSideButtonClick(e)})}setupScrollWheelListener(){window.addEventListener("scrollUp",e=>{this.scrollWheelEnabled&&this.handleScrollWheel({direction:"up",event:e})}),window.addEventListener("scrollDown",e=>{this.scrollWheelEnabled&&this.handleScrollWheel({direction:"down",event:e})})}setupKeyboardFallback(){window.addEventListener("keydown",e=>{if(e.code==="Space"){e.preventDefault();const o=new CustomEvent("sideClick",{detail:{source:"keyboard"}});window.dispatchEvent(o)}})}handleSideButtonClick(e){(this.eventListeners.get("sideButton")||[]).forEach(r=>r(e))}handleScrollWheel(e){(this.eventListeners.get("scrollWheel")||[]).forEach(r=>r({direction:e.direction,event:e.event}))}on(e,o){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(o)}off(e,o){const r=this.eventListeners.get(e)||[],l=r.indexOf(o);l>-1&&r.splice(l,1)}}const I=new $;class D{constructor(){this.screenWidth=240}setupViewport(){let e=document.querySelector('meta[name="viewport"]');e||(e=document.createElement("meta"),e.name="viewport",document.head.appendChild(e)),e.content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"}}const F=new D;F.setupViewport();I.init();const i=document.getElementById("glcanvas"),n=i.getContext("2d"),x=24,h=12,U=.75,M=200,T=25,H=2;let d=1,v=M,p=0,y=0,E=0,k=0,w=!1,u=0,f=Number.parseInt(localStorage.getItem("stackerHighScore")||"0",10)||0,A=0,L="";function B(t,e=1e3){L=t,A=performance.now()+e}let m=[],s=null,g=null;function N(){if(!g){const t=window.AudioContext||window.webkitAudioContext;if(t)try{g=new t}catch{g=null}}}function S(t=440,e=.08,o="sine",r=.08){if(!g)return;const l=g.createOscillator(),a=g.createGain();l.type=o,l.frequency.value=t,a.gain.value=0,l.connect(a),a.connect(g.destination);const c=g.currentTime;a.gain.linearRampToValueAtTime(r,c+.005),a.gain.exponentialRampToValueAtTime(1e-4,c+e),l.start(c),l.stop(c+e+.02)}function G(t){S(t?880:660,t?.07:.06,"square",t?.06:.05)}function _(){S(520,.05,"triangle",.05)}function q(){S(990,.1,"sine",.07)}function K(){S(220,.25,"sawtooth",.08)}function W(){const t=Math.min(window.devicePixelRatio||1,2),e=Math.floor(i.clientWidth*t),o=Math.floor(i.clientHeight*t);(i.width!==e||i.height!==o)&&(i.width=e,i.height=o),p=h,y=i.width-h,E=i.height-h-x,k=h*2}function V(){i.style.width||(i.style.width="100vw"),i.style.height||(i.style.height="100vh"),i.style.display="block"}V();W();window.addEventListener("resize",()=>{W(),b(d,!0)});function b(t,e){d=t,e||(v=M+(d-1)*T),m=[],w=!1;const o=Math.floor((y-p)*U),r=Math.floor((i.width-o)/2);m.push({x:r,y:E,width:o,height:x}),s={x:p,y:E-x,width:o,height:x,dir:1}}function z(){const t=v+T;b(d+1,!0),v=t,q(),B(`Level ${d}`,1e3)}function X(){u=0,d=1,v=M,b(1,!0),w=!1,B(`Level ${d}`,1e3)}function Y(){if(w||!s||m.length===0)return;const t=m[m.length-1],e=Math.max(s.x,t.x),r=Math.min(s.x+s.width,t.x+t.width)-e;if(r<=0){if(w=!0,u>f){f=u;try{localStorage.setItem("stackerHighScore",String(f))}catch{}}K();return}const l={x:Math.floor(e),y:s.y,width:Math.floor(r),height:x};if(m.push(l),u+=1,u>f){f=u;try{localStorage.setItem("stackerHighScore",String(f))}catch{}}v+=H,l.width<s.width?_():G(l.width===s.width),s.width=l.width,s.x=Math.max(p,Math.min(l.x,y-s.width)),s.y-=x,s.y<=k&&z()}function P(){N(),w?X():Y()}I.on("sideButton",P);i.addEventListener("pointerdown",t=>{t&&t.preventDefault&&t.preventDefault(),!(t&&t.isPrimary===!1)&&P()},{passive:!1});function j(){n.fillStyle="#000",n.fillRect(0,0,i.width,i.height)}function C(t,e){n.fillStyle=e,n.fillRect(t.x,t.y,t.width,t.height)}function J(){n.fillStyle="rgba(255,255,255,0.9)",n.textBaseline="top",n.font=`${Math.max(10,Math.floor(i.height*.04))}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`,n.fillText(`Level ${d}`,h,h),n.textAlign="right",n.fillText(`Score ${u}`,i.width-h,h),n.textAlign="left",n.font=`${Math.max(9,Math.floor(i.height*.03))}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`,n.fillStyle="rgba(200,200,200,0.9)",n.fillText(`Best ${f}`,h,h+Math.max(12,Math.floor(i.height*.05)))}function Q(t){t<=A&&L&&(n.fillStyle="rgba(0,0,0,0.6)",n.fillRect(0,0,i.width,i.height),n.fillStyle="#fff",n.textAlign="center",n.textBaseline="middle",n.font=`${Math.max(14,Math.floor(i.height*.07))}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`,n.fillText(L,i.width/2,i.height*.45))}function Z(){n.fillStyle="rgba(0,0,0,0.6)",n.fillRect(0,0,i.width,i.height),n.fillStyle="#fff",n.textAlign="center",n.textBaseline="middle",n.font=`${Math.max(14,Math.floor(i.height*.07))}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`,n.fillText("Game Over",i.width/2,i.height*.38),n.font=`${Math.max(10,Math.floor(i.height*.04))}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`,n.fillText(`Score ${u}   Best ${f}`,i.width/2,i.height*.5),n.font=`${Math.max(10,Math.floor(i.height*.035))}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`,n.fillStyle="rgba(255,255,255,0.9)",n.fillText("Press Space or Click to Restart",i.width/2,i.height*.62)}let R=performance.now();function O(t){const e=Math.min(.05,Math.max(0,(t-R)*.001));R=t,s&&!w&&(s.x+=s.dir*v*e,s.x<=p?(s.x=p,s.dir=1):s.x+s.width>=y&&(s.x=y-s.width,s.dir=-1)),j(),n.fillStyle="#222",n.fillRect(p-2,h,4,i.height-h*2),n.fillRect(y-2,h,4,i.height-h*2);for(let o=0;o<m.length;o++){const r=o===0?"#2e7d32":"#1976d2";C(m[o],r)}s&&C(s,"#ff7043"),J(),Q(t),w&&Z(),requestAnimationFrame(O)}b(1,!1);B(`Level ${d}`,1e3);requestAnimationFrame(O);
