(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function o(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=o(n);fetch(n.href,a)}})();class A{constructor(){this.sideButtonEnabled=!0,this.scrollWheelEnabled=!0,this.eventListeners=new Map}init(e={}){this.sideButtonEnabled=e.sideButtonEnabled??!0,this.scrollWheelEnabled=e.scrollWheelEnabled??!0,this.sideButtonEnabled&&this.setupSideButtonListener(),this.scrollWheelEnabled&&this.setupScrollWheelListener(),e.keyboardFallback!==!1&&this.setupKeyboardFallback()}setupSideButtonListener(){window.addEventListener("sideClick",e=>{this.sideButtonEnabled&&this.handleSideButtonClick(e)})}setupScrollWheelListener(){window.addEventListener("scrollUp",e=>{this.scrollWheelEnabled&&this.handleScrollWheel({direction:"up",event:e})}),window.addEventListener("scrollDown",e=>{this.scrollWheelEnabled&&this.handleScrollWheel({direction:"down",event:e})})}setupKeyboardFallback(){window.addEventListener("keydown",e=>{if(e.code==="Space"){e.preventDefault();const o=new CustomEvent("sideClick",{detail:{source:"keyboard"}});window.dispatchEvent(o)}})}handleSideButtonClick(e){(this.eventListeners.get("sideButton")||[]).forEach(r=>r(e))}handleScrollWheel(e){(this.eventListeners.get("scrollWheel")||[]).forEach(r=>r({direction:e.direction,event:e.event}))}on(e,o){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(o)}off(e,o){const r=this.eventListeners.get(e)||[],n=r.indexOf(o);n>-1&&r.splice(n,1)}}const C=new A;class O{constructor(){this.screenWidth=240}setupViewport(){let e=document.querySelector('meta[name="viewport"]');e||(e=document.createElement("meta"),e.name="viewport",document.head.appendChild(e)),e.content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"}}const P=new O;P.setupViewport();C.init();const t=document.getElementById("glcanvas"),s=t.getContext("2d"),m=24,h=12,D=.6,L=120,I=18;let x=1,v=L,u=0,g=0,E=0,R=0,p=!1,w=0,y=Number.parseInt(localStorage.getItem("stackerHighScore")||"0",10)||0,f=[],l=null,d=null;function $(){if(!d){const i=window.AudioContext||window.webkitAudioContext;if(i)try{d=new i}catch{d=null}}}function S(i=440,e=.08,o="sine",r=.08){if(!d)return;const n=d.createOscillator(),a=d.createGain();n.type=o,n.frequency.value=i,a.gain.value=0,n.connect(a),a.connect(d.destination);const c=d.currentTime;a.gain.linearRampToValueAtTime(r,c+.005),a.gain.exponentialRampToValueAtTime(1e-4,c+e),n.start(c),n.stop(c+e+.02)}function H(i){S(i?880:660,i?.07:.06,"square",i?.06:.05)}function N(){S(520,.05,"triangle",.05)}function U(){S(990,.1,"sine",.07)}function F(){S(220,.25,"sawtooth",.08)}function T(){const i=Math.min(window.devicePixelRatio||1,2),e=Math.floor(t.clientWidth*i),o=Math.floor(t.clientHeight*i);(t.width!==e||t.height!==o)&&(t.width=e,t.height=o),u=h,g=t.width-h,E=t.height-h-m,R=h*2}function G(){t.style.width||(t.style.width="100vw"),t.style.height||(t.style.height="100vh"),t.style.display="block"}G();T();window.addEventListener("resize",()=>{T(),b(x,!0)});function b(i,e){x=i,e||(v=L+(x-1)*I),f=[],p=!1;const o=Math.floor((g-u)*D),r=Math.floor((t.width-o)/2);f.push({x:r,y:E,width:o,height:m}),l={x:u,y:E-m,width:o,height:m,dir:1}}function q(){b(x+1,!1),U()}function _(){w=0,x=1,v=L,b(1,!0),p=!1}function K(){if(p||!l||f.length===0)return;const i=f[f.length-1],e=Math.max(l.x,i.x),r=Math.min(l.x+l.width,i.x+i.width)-e;if(r<=0){if(p=!0,w>y){y=w;try{localStorage.setItem("stackerHighScore",String(y))}catch{}}F();return}const n={x:Math.floor(e),y:l.y,width:Math.floor(r),height:m};f.push(n),w+=1,n.width<l.width?N():H(n.width===l.width),l.width=n.width,l.x=Math.max(u,Math.min(n.x,g-l.width)),l.y-=m,l.y<=R&&(v+=I,q())}function W(){$(),p?_():K()}C.on("sideButton",W);t.addEventListener("pointerdown",i=>{i&&i.preventDefault&&i.preventDefault(),!(i&&i.isPrimary===!1)&&W()},{passive:!1});function V(){s.fillStyle="#000",s.fillRect(0,0,t.width,t.height)}function M(i,e){s.fillStyle=e,s.fillRect(i.x,i.y,i.width,i.height)}function z(){s.fillStyle="rgba(255,255,255,0.9)",s.textBaseline="top",s.font=`${Math.max(10,Math.floor(t.height*.04))}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`,s.fillText(`Level ${x}`,h,h),s.textAlign="right",s.fillText(`Score ${w}`,t.width-h,h),s.textAlign="left",s.font=`${Math.max(9,Math.floor(t.height*.03))}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`,s.fillStyle="rgba(200,200,200,0.9)",s.fillText(`Best ${y}`,h,h+Math.max(12,Math.floor(t.height*.05)))}function X(){s.fillStyle="rgba(0,0,0,0.6)",s.fillRect(0,0,t.width,t.height),s.fillStyle="#fff",s.textAlign="center",s.textBaseline="middle",s.font=`${Math.max(14,Math.floor(t.height*.07))}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`,s.fillText("Game Over",t.width/2,t.height*.38),s.font=`${Math.max(10,Math.floor(t.height*.04))}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`,s.fillText(`Score ${w}   Best ${y}`,t.width/2,t.height*.5),s.font=`${Math.max(10,Math.floor(t.height*.035))}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`,s.fillStyle="rgba(255,255,255,0.9)",s.fillText("Press Space or Click to Restart",t.width/2,t.height*.62)}let B=performance.now();function k(i){const e=Math.min(.05,Math.max(0,(i-B)*.001));B=i,l&&!p&&(l.x+=l.dir*v*e,l.x<=u?(l.x=u,l.dir=1):l.x+l.width>=g&&(l.x=g-l.width,l.dir=-1)),V(),s.fillStyle="#222",s.fillRect(u-2,h,4,t.height-h*2),s.fillRect(g-2,h,4,t.height-h*2);for(let o=0;o<f.length;o++){const r=o===0?"#2e7d32":"#1976d2";M(f[o],r)}l&&M(l,"#ff7043"),z(),p&&X(),requestAnimationFrame(k)}b(1,!1);requestAnimationFrame(k);
