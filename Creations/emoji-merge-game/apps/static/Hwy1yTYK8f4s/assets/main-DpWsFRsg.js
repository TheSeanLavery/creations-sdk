(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();console.log("Emoji Merge Game starting...");console.log(typeof PluginMessageHandler<"u"?"Running as R1 Creation":"Running in browser mode");const y=240,p=282,b=.3,L=.98,m=20,O=50,g=["😀","😃","😄","😁","😆","😅","🤣","😂","🙂","🙃","😉","😊","😇","🥰","😍","🤩","😘","😗","😚","😙","😋","😛","😜","🤪","😝","🤑","🤗","🤭","🤫","🤔","🤐","🤨","😐","😑","😶","😏","😒","🙄","😬","🤥","😌","😔","😪","🤤","😴","😷","🤒","🤕","🤢","🤮","🤧","🥵","🥶","🥴","😵","🤯","🤠","🥳","😎","🤓","🧐","😕","😟","🙁","☹️","😮","😯","😲","😳","🥺","😦","😧","😨","😰","😥","😢","😭","😱","😖","😣","😞","😓","😩","😫","🥱","😤","😡","😠","🤬","😈","👿","💀","☠️","💩","🤡","👹","👺","👻","👽","👾"];let u,a,d=1,D=!1,I=0,j={x:0,y:0,z:0},E={x:0,y:0,z:0},h=!1,A=0,T=0;class S{constructor(e,t,s,i){this.x=e,this.y=t,this.vx=0,this.vy=0,this.level=s,this.emoji=i,this.radius=m/2,this.active=!0,this.canMerge=!0,this.mergeTimeout=0}update(){if(this.active){if(h)this.vx+=j.x*.5,this.vy+=b+j.y*.3;else{const e=Math.sin(T),t=Math.cos(A)-1;this.vx+=e*.6,this.vy+=b+t*.6}this.vx*=L,this.vy*=L,this.x+=this.vx,this.y+=this.vy,this.x-this.radius<0?(this.x=this.radius,this.vx*=-.7):this.x+this.radius>y&&(this.x=y-this.radius,this.vx*=-.7),this.y+this.radius>p&&(this.y=p-this.radius,this.vy*=-.7),this.y<0&&this.y<-this.radius&&(this.y=-this.radius,this.vy=Math.max(0,this.vy)),this.mergeTimeout>0&&(this.mergeTimeout--,this.mergeTimeout<=0&&(this.canMerge=!0))}}draw(){this.active&&(a.save(),a.font=`${m}px Arial`,a.textAlign="center",a.textBaseline="middle",a.fillText(this.emoji,this.x,this.y),a.font=`${m*.4}px Arial`,a.fillStyle="#FE5F00",a.strokeStyle="#000",a.lineWidth=1,a.strokeText(this.level.toString(),this.x,this.y+m*.6),a.fillText(this.level.toString(),this.x,this.y+m*.6),a.restore())}checkCollision(e){if(!this.active||!e.active||this===e)return!1;const t=this.x-e.x,s=this.y-e.y;return Math.sqrt(t*t+s*s)<this.radius+e.radius}bounce(e){const t=this.x-e.x,s=this.y-e.y,i=Math.sqrt(t*t+s*s);if(i===0)return;const o=this.radius+e.radius-i,r=t/i*o*.5,c=s/i*o*.5;this.x+=r,this.y+=c,e.x-=r,e.y-=c;const f=this.vx,x=this.vy;this.vx=e.vx*.8,this.vy=e.vy*.8,e.vx=f*.8,e.vy=x*.8}}class F{constructor(e){this.pool=[],this.activeEmojis=[];for(let t=0;t<e;t++)this.pool.push(new S(0,0,1,g[0]))}get(e,t,s,i){let o;return this.pool.length>0?(o=this.pool.pop(),o.x=e,o.y=t,o.vx=0,o.vy=0,o.level=s,o.emoji=i,o.active=!0,o.canMerge=!0,o.mergeTimeout=0):o=new S(e,t,s,i),this.activeEmojis.push(o),o}release(e){e.active=!1;const t=this.activeEmojis.indexOf(e);t>-1&&(this.activeEmojis.splice(t,1),this.pool.push(e))}clear(){this.activeEmojis.forEach(e=>{e.active=!1,this.pool.push(e)}),this.activeEmojis=[]}}let l;function G(){u=document.getElementById("game-canvas"),a=u.getContext("2d"),u.width=y,u.height=p,l=new F(O),_(60),D=!0,q(),X()}const w=new Map;function V(n,e){const t=(l==null?void 0:l.activeEmojis)||[];for(let s=t.length-1;s>=0;s--){const i=t[s],o=n-i.x,r=e-i.y;if(o*o+r*r<=i.radius*i.radius)return i}return null}function P(n,e){const t=u.getBoundingClientRect(),s=y/t.width,i=p/t.height,o=(n-t.left)*s,r=(e-t.top)*i;return{x:o,y:r}}function q(){u.addEventListener("pointerdown",e=>{var r;(r=u.setPointerCapture)==null||r.call(u,e.pointerId);const{x:t,y:s}=P(e.clientX,e.clientY),i=V(t,s);if(!i)return;const o={emoji:i,offsetX:t-i.x,offsetY:s-i.y,lastX:t,lastY:s,lastT:performance.now()};i.vx=0,i.vy=0,w.set(e.pointerId,o)}),u.addEventListener("pointermove",e=>{const t=w.get(e.pointerId);if(!t)return;const s=performance.now(),{x:i,y:o}=P(e.clientX,e.clientY),r=i-t.offsetX,c=o-t.offsetY;t.emoji.x=Math.max(t.emoji.radius,Math.min(y-t.emoji.radius,r)),t.emoji.y=Math.max(t.emoji.radius,Math.min(p-t.emoji.radius,c));const f=Math.max(1,s-t.lastT)/1e3;t.emoji.vx=(i-t.lastX)/f*.05,t.emoji.vy=(o-t.lastY)/f*.05,t.lastX=i,t.lastY=o,t.lastT=s});function n(e){const t=w.get(e.pointerId);t&&(t.emoji.canMerge=!1,t.emoji.mergeTimeout=Math.max(t.emoji.mergeTimeout,10),w.delete(e.pointerId))}u.addEventListener("pointerup",n),u.addEventListener("pointercancel",n)}function C(){if(l.activeEmojis.length>=O||!!l.activeEmojis.some(c=>c.active&&c.y<p/2))return;let e=1;const t=Math.random();d>1&&(t<.1&&d>2?e=d-1:t<.3&&d>1?e=Math.floor(Math.random()*(d-1))+1:e=Math.floor(Math.random()*Math.min(d,3))+1);const s=Math.random()*(y-m)+m/2,i=-m,o=(e-1)%g.length,r=g[o];l.get(s,i,e,r)}function H(){const n=l.activeEmojis;n.forEach(e=>e.update());for(let e=0;e<n.length;e++)for(let t=e+1;t<n.length;t++){const s=n[e],i=n[t];s.checkCollision(i)&&(s.level===i.level&&s.canMerge&&i.canMerge?N(s,i):s.bounce(i))}}function N(n,e){$();const t=(n.x+e.x)/2,s=(n.y+e.y)/2,i=n.level+1;i>d&&(d=i,R()),l.release(n),l.release(e);const o=(i-1)%g.length,r=l.get(t,s,i,g[o]);r.canMerge=!1,r.mergeTimeout=30}function $(){if(typeof AudioContext<"u"||typeof webkitAudioContext<"u")try{const n=new(AudioContext||webkitAudioContext),e=n.createOscillator(),t=n.createGain();e.connect(t),t.connect(n.destination),e.frequency.setValueAtTime(800,n.currentTime),e.frequency.exponentialRampToValueAtTime(200,n.currentTime+.1),t.gain.setValueAtTime(.3,n.currentTime),t.gain.exponentialRampToValueAtTime(.01,n.currentTime+.1),e.start(n.currentTime),e.stop(n.currentTime+.1)}catch{console.log("Audio context not available")}}function R(){const n=document.getElementById("max-level-display");n&&(n.textContent=`Max: ${d}`)}function B(){a.fillStyle="#000",a.fillRect(0,0,y,p),l.activeEmojis.forEach(n=>n.draw());try{const n=document.getElementById("gyro-overlay");if(n){const e=h?E.x:Math.sin(T),t=h?E.y:Math.sin(A),s=h?E.z:0;n.textContent=`x: ${e.toFixed(2)}
y: ${t.toFixed(2)}
z: ${s.toFixed(2)}`}}catch{}}function X(){if(!D)return;const n=Date.now();n-I>2e3&&(C(),I=n),H(),B(),requestAnimationFrame(X)}let M=!1;function _(n=60){var s;let e=(s=window==null?void 0:window.creationSensors)==null?void 0:s.accelerometer;const t=()=>{var i;try{const o=e||((i=window==null?void 0:window.creationSensors)==null?void 0:i.accelerometer);return!o||typeof o.start!="function"?!1:(o.start(r=>{const c=typeof r.tiltX=="number"?r.tiltX:typeof r.x=="number"?r.x:0,f=typeof r.tiltY=="number"?r.tiltY:typeof r.y=="number"?r.y:-1,x=typeof r.tiltZ=="number"?r.tiltZ:typeof r.z=="number"?r.z:0;E={x:c,y:f,z:x};const Y=c,z=-f,k=-x;j={x:Y,y:z,z:k},h=!0},{frequency:n}),M=!0,console.log("Accelerometer started"),!0)}catch(o){return console.error("Error starting accelerometer:",o),!1}};if(!e){console.log("Accelerometer API not available - using fallback, will retry"),v();let i=0;const o=40,r=setInterval(()=>{var c;if(h||M){clearInterval(r);return}e=(c=window==null?void 0:window.creationSensors)==null?void 0:c.accelerometer,e&&(e&&typeof e.isAvailable=="function"?e.isAvailable().then(f=>{f&&t()&&clearInterval(r)}).catch(()=>{}):t()&&clearInterval(r)),i++,i>=o&&clearInterval(r)},300)}try{e&&typeof e.isAvailable=="function"?e.isAvailable().then(c=>{c&&t()||v()}).catch(()=>{t()||v()}):t()||v();let i=0;const o=20,r=setInterval(()=>{if(h||M){clearInterval(r);return}t()&&clearInterval(r),i++,i>=o&&clearInterval(r)},300)}catch(i){console.error("Accelerometer init error:",i),v()}return!0}function v(){try{const n=t=>{const s=(t.beta||0)*Math.PI/180,i=(t.gamma||0)*Math.PI/180;A=Math.max(-Math.PI/2,Math.min(Math.PI/2,s)),T=Math.max(-Math.PI/2,Math.min(Math.PI/2,i))},e=window.DeviceOrientationEvent;e&&e.requestPermission?document.body.addEventListener("click",async()=>{try{await e.requestPermission()==="granted"&&window.addEventListener("deviceorientation",n)}catch{}},{once:!0}):e&&window.addEventListener("deviceorientation",n),console.log("Using deviceorientation fallback")}catch{}}window.addEventListener("scrollUp",()=>{console.log("Scroll up detected - spawning emoji"),C()});window.addEventListener("scrollDown",()=>{console.log("Scroll down detected - spawning emoji"),C()});window.addEventListener("sideClick",()=>{console.log("Side button clicked - restarting game"),U()});function U(){l&&l.clear(),d=1,R(),I=0}document.addEventListener("DOMContentLoaded",()=>{console.log("Emoji Merge Game initialized!"),typeof PluginMessageHandler>"u"&&window.addEventListener("keydown",n=>{n.code==="Space"&&(n.preventDefault(),window.dispatchEvent(new CustomEvent("sideClick"))),n.code==="ArrowUp"&&(n.preventDefault(),window.dispatchEvent(new CustomEvent("scrollUp"))),n.code==="ArrowDown"&&(n.preventDefault(),window.dispatchEvent(new CustomEvent("scrollDown")))}),G()});console.log("Emoji Merge Game Ready!");console.log("Controls:");console.log("- Side button: Restart game");console.log("- Scroll wheel: Spawn emoji");console.log("- Gyro: Controls gravity direction");
